{% extends "base.html" %}

{% block title %}Participant Dashboard{% endblock %}

{% block content %}
<style>
    :root {
        --primary-purple: #6a0dad;
        --secondary-purple: #8a2be2;
        --light-purple: #9370db;
        --dark-blue: #4b0082;
        --light-blue: #e6e6fa;
        --gradient-primary: linear-gradient(135deg, #6a0dad 0%, #4b0082 100%);
        --gradient-secondary: linear-gradient(135deg, #8a2be2 0%, #6a0dad 100%);
        --gradient-card: linear-gradient(135deg, #f8f4ff 0%, #f0ebff 100%);
    }
    
    body {
        background-color: #faf9ff;
        color: #333;
    }
    
    .dashboard-header {
    background: var(--gradient-primary);
    color: #e9d7ff; /* lighter lavender shade */
    padding: 2rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 20px rgba(106, 13, 173, 0.2);
}

    
    .welcome-badge {
        background: rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    .dashboard-header h1,
.dashboard-header p,
.dashboard-header span {
    color: #e9d7ff !important;
}

    
    h1, h2 {
        color: var(--dark-blue);
        font-weight: 700;
    }
    
    h2 {
        margin-top: 2rem;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--light-blue);
    }
    
    .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .test-card {
        background: var(--gradient-card);
        border: none;
        border-radius: 15px;
        padding: 1.5rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(106, 13, 173, 0.1);
        display: block;
        position: relative;
        overflow: hidden;
    }
    
    .test-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: var(--gradient-primary);
    }
    
    .test-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(106, 13, 173, 0.2);
        text-decoration: none;
        color: inherit;
    }
    
    .test-card__title {
        color: var(--primary-purple);
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .test-card__action {
        margin-top: 1rem;
    }
    
    .btn-start {
        background: var(--gradient-secondary);
        color: white;
        border: none;
        padding: 0.5rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-start:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(106, 13, 173, 0.3);
    }
    
    .list-group-item {
        border: 1px solid var(--light-blue);
        border-radius: 10px !important;
        margin-bottom: 0.5rem;
        transition: all 0.3s ease;
        padding: 1rem 1.5rem;
    }
    
    .list-group-item:hover {
        border-color: var(--light-purple);
        transform: translateX(5px);
    }
    
    .badge {
        background: var(--gradient-secondary) !important;
        padding: 0.5rem 1rem;
    }
    
    .alert-info {
        background-color: #f0ebff;
        border-color: var(--light-purple);
        color: var(--dark-blue);
        border-radius: 10px;
    }
    
    .fade-in {
        animation: fadeIn 0.5s ease forwards;
        opacity: 0;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .text-primary {
        color: var(--primary-purple) !important;
    }
    
    .text-muted {
        color: #6c757d !important;
    }
</style>

<div class="container py-4">
    <div class="dashboard-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h1 class="display-5 fw-bold">Adaptive Test Modules</h1>
                <p class="mb-0">Select a <strong>Topic</strong> below.</p>
            </div>
            <div class="welcome-badge mt-3 mt-md-0">
                <span>Welcome, {{ current_user.username }}</span>
            </div>
        </div>
    </div>

    <!-- Topic Filter -->
    <div class="mb-4">
        <label for="topicFilter" class="form-label fw-semibold">Filter Topics:</label>
        <select id="topicFilter" class="form-select w-auto d-inline-block ms-2">
            <option value="all" selected>All</option>
            <option value="cs">CS</option>
            <option value="gk">GK</option>
            <option value="math">Math</option>
            <option value="english">English</option>
        </select>
    </div>

    <!-- Topic Selection -->
    <h2>Select a Topic</h2>
    <div class="test-grid">
        {% for topic in available_topics %}
        <a href="{{ url_for('topic_detail', topic=topic) }}" 
           class="test-card fade-in topic-card" 
           data-topic="{{ topic|lower }}"
           style="animation-delay: {{ loop.index0 * 0.15 }}s;">
            <div class="test-card__body">
                <h3 class="test-card__title">{{ topic | title }}</h3>
                <p class="text-muted">Click to choose difficulty</p>
                <div class="test-card__action">
                    <span class="btn btn-start" style="width: auto;">
                        Choose Difficulty <i class="fas fa-arrow-right ms-2"></i>
                    </span>
                </div>
            </div>
        </a>
        {% endfor %}
    </div>

    {% if not available_topics %}
    <div class="alert alert-info mt-3">No topics available yet.</div>
    {% endif %}

    <!-- Recent Submissions -->
    <h2 class="mt-5 mb-3">Recent Test Submissions</h2>
    <div class="list-group">
        {% if recent_submissions %}
            {% for submission in recent_submissions %}
            {% set test = submission.test %}
            <a href="{{ url_for('show_results', submission_id=submission.id) }}" 
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                    <strong class="text-primary">{{ test.topic | title }}</strong> - {{ test.difficulty | title }} ({{ test.title }})
                    <small class="text-muted d-block">Score: {{ submission.score }}/20</small>
                </div>
                <span class="badge bg-secondary rounded-pill">View Results</span>
            </a>
            {% endfor %}
        {% else %}
            <div class="alert alert-info">You haven't completed any tests yet.</div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const filter = document.getElementById('topicFilter');
    const topicCards = document.querySelectorAll('.topic-card');

    filter.addEventListener('change', function () {
        const selected = this.value;
        topicCards.forEach(card => {
            const topic = card.getAttribute('data-topic');
            if (selected === "all" || topic.includes(selected)) {
                card.style.display = "flex";
            } else {
                card.style.display = "none";
            }
        });
    });
});
</script>
{% endblock %}
